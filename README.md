# Wallet Service

Wallet Service — это приложение для управления балансом игрока, позволяющее регистрировать новых игроков, авторизовывать их, пополнять и снимать средства, а также просматривать историю транзакций.

## Основные функции

1. **Регистрация нового игрока**: Создание новой учетной записи с именем пользователя и паролем.
2. **Авторизация**: Вход в систему с использованием имени пользователя и пароля.
3. **Просмотр баланса**: Пользователи могут просматривать свой текущий баланс.
4. **Пополнение баланса**: Пользователи могут пополнять свой баланс.
5. **Снятие средств**: Пользователи могут снимать средства со своего баланса.
6. **Просмотр истории транзакций**: Доступ к истории транзакций для администраторов.


## Тестовый доступ для просмотра аудита

Для быстрой демонстрации функциональности просмотра аудита в приложении уже предустановлен аккаунт администратора:
- Имя пользователя: `admin`
- Пароль: `admin`

## Аутентификация

Для доступа к защищенным ресурсам API необходимо аутентифицироваться с использованием JWT (JSON Web Token).

Authorization: Bearer {YOUR_JWT_TOKEN}

На запрос с использованием "/admin/audits" нужно войти под логином и паролем выше.


### 1. Получение токена

Отправьте POST-запрос на `http://localhost:8080/login`. В теле запроса указать логин пароль в формате:

{
"username": "admin",
"password": "admin"
}

В ответе вы получите токен в формате:

```json
{
  "status": "success",
  "message": "Успешная авторизация",
  "token": "JWT_TOKEN"
}
```

## API

### Для выполнения запросов к API необходимо использовать действующий JWT.
### Для получения токена обратитесь к документации по аутентификации.
### При выполнении запросов токен должен передаваться в заголовке Authorization в формате:

`Authorization: Bearer YOUR_JWT_TOKEN`

## API для работы с балансом

1. Получение текущего баланса 
    - Метод: GET
    - URL: http://localhost:8080/balances
    - Описание: Получение текущего баланса авторизованного пользователя. 
+ Заголовки:
    - Authorization: Bearer <ваш_токен>
+ Пример запроса: GET http://localhost:8080/balances 
+ Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

{
"message": "Текущий баланс: 1000"
}

	•	Коды ответа:
	•	200 OK: Успешное выполнение.
	•	401 Unauthorized: Пользователь не авторизован или токен невалиден.

2. Операции с балансом (пополнение или снятие средств)
   •	Метод: POST
   •	URL: http://localhost:8080/balances
   •	Описание: Выполнение операций с балансом: пополнение (deposit) или снятие средств (withdraw).
   •	Заголовки:

Authorization: Bearer <ваш_токен>


	•	Параметры тела запроса:
	•	action (строка): Действие (deposit или withdraw).
	•	amount (число): Сумма операции.
	•	transaction_id (строка): Уникальный идентификатор транзакции (UUID).
	•	Пример тела запроса (пополнение):

{
"action": "deposit",
"amount": 1000,
"transaction_id": "f47ac10b-58cc-4372-a567-0e02b2c3d479"
}


	•	Пример тела запроса (снятие):

{
"action": "withdraw",
"amount": 500,
"transaction_id": "a8098c1a-f86e-11da-bd1a-00112444be1e"
}


	•	Пример ответа (успешно):

{
"message": "Средства успешно зачислены"
}

или

{
"message": "Средства успешно сняты"
}


	•	Пример ответа (недостаточно средств):

{
"message": "Недостаточно средств"
}


	•	Коды ответа:
	•	200 OK: Успешное выполнение.
	•	400 Bad Request: Ошибка валидации или параметры запроса неверны.
	•	401 Unauthorized: Пользователь не авторизован или токен невалиден.
	•	500 Internal Server Error: Внутренняя ошибка сервера.

Примечания
1.	Аутентификация:
Для выполнения всех запросов необходимо передать JWT-токен в заголовке Authorization. Токен можно получить, отправив запрос на /login (см. документацию по аутентификации).
2.	Формат заголовка Authorization:

Authorization: Bearer <ваш_токен>


	3.	UUID для transaction_id:
Убедитесь, что transaction_id уникален для каждой операции, чтобы избежать ошибок при повторных транзакциях.


## Для запуска PostgreSQL в Docker:

1. Убедитесь, что у вас установлен Docker и docker-compose.
2. Перейдите в каталог проекта и выполните команду:
```bash
docker-compose up -d
```
3. Для остановки и удалении всех контейнеров
```bash
docker-compose down
```



